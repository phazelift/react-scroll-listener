// Generated by CoffeeScript 1.10.0
(function() {
  var Mixin, ScrollListener, ViewportMetrics, _scrollListeners, getScrollListener, types,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  ViewportMetrics = require('react/lib/ViewportMetrics');

  types = require('types.js');

  ScrollListener = (function() {
    var DEFAULT_TIMEOUT_DELAY;

    DEFAULT_TIMEOUT_DELAY = 300;

    function ScrollListener(settings) {
      this._onHostScroll = bind(this._onHostScroll, this);
      this._onHostScrollEnd = bind(this._onHostScrollEnd, this);
      settings = types.forceObject(settings);
      this.scrollHost = types.forceObject(settings.host);
      this.scrollStartHandlers = {};
      this.scrollEndHandlers = {};
      this.scrollTop = 0;
      this.isScrolling = false;
      this.scrollTimeoutDelay = types.forceNumber(settings.delay, DEFAULT_TIMEOUT_DELAY);
      this._scrollTimeout = void 0;
      this.scrollListenerAdded = false;
    }

    ScrollListener.prototype.addScrollEventListener = function() {
      if (this.scrollListenerAdded) {
        return;
      }
      if (!this.scrollHost.addEventListener) {
        if ('undefined' === typeof window) {
          return console.log('ScrollListener::addScrollEventListener -> bad or missing host/window, cannot add event-listener!');
        } else {
          this.scrollHost = window;
        }
      }
      this.scrollHost.addEventListener('scroll', this._onHostScroll);
      return this.scrollListenerAdded = true;
    };

    ScrollListener.prototype.removeScrollEventListener = function() {
      return this.scrollHost.removeEventListener('scroll', this._onHostScroll);
    };

    ScrollListener.prototype.setScrollHandler = function(id, handler, onScrollEnd) {};

    ScrollListener.prototype.addScrollHandler = function(id, handler, onScrollEnd) {
      id = types.forceString(id);
      if (!id) {
        return console.log('ScrollListener::addScrollHandler -> could not add handler! id: ' + id);
      }
      handler = types.forceFunction(handler);
      if (onScrollEnd && !this.scrollEndHandlers[id]) {
        this.scrollEndHandlers[id] = handler;
      } else if (!this.scrollStartHandlers[id]) {
        this.scrollStartHandlers[id] = handler;
      }
      return this.addScrollEventListener();
    };

    ScrollListener.prototype.removeScrollHandler = function(id, onScrollEnd) {
      if (onScrollEnd) {
        return delete this.scrollEndHandlers[id];
      } else {
        return delete this.scrollStartHandlers[id];
      }
    };

    ScrollListener.prototype._onHostScrollEnd = function() {
      var handler, results;
      if (this.scrollTop === ViewportMetrics.currentScrollTop) {
        clearTimeout(this._scrollTimeout);
        this.isScrolling = false;
        results = [];
        for (handler in this.scrollEndHandlers) {
          results.push(this.scrollEndHandlers[handler]());
        }
        return results;
      }
    };

    ScrollListener.prototype._onHostScroll = function() {
      var handler;
      this.isScrolling = true;
      this.scrollTop = ViewportMetrics.currentScrollTop;
      clearTimeout(this._scrollTimeout);
      for (handler in this.scrollStartHandlers) {
        this.scrollStartHandlers[handler]();
      }
      return this._scrollTimeout = setTimeout(this._onHostScrollEnd, this.scrollTimeoutDelay);
    };

    return ScrollListener;

  })();

  _scrollListeners = {};

  getScrollListener = function(id) {
    return _scrollListeners[id] || (_scrollListeners[id] = new ScrollListener);
  };

  Mixin = function(id, startHandlerId, endHandlerId) {
    var scrollEndId, scrollStartId;
    scrollStartId = types.forceString(startHandlerId, Date.now());
    scrollEndId = types.forceString(endHandlerId, Date.now() + 1);
    return Mixin = {
      scrollListener: getScrollListener(types.forceString(id, 'generic')),
      componentDidMount: function() {
        this.scrollListener.addScrollHandler(scrollStartId, this.onScrollStart);
        return this.scrollListener.addScrollHandler(scrollEndId, this.onScrollEnd, true);
      },
      componentWillUnmount: function() {
        this.scrollListener.removeScrollHandler(scrollStartId);
        return this.scrollListener.removeScrollHandler(scrollEndId, true);
      }
    };
  };

  Mixin.componentWillMount = function() {
    throw new Error('You are trying to use ScrollListener.Mixin as an object, but it\'s a Function! Check the mixin for usage details.');
  };

  ScrollListener.Mixin = Mixin;

  module.exports = ScrollListener;

}).call(this);
